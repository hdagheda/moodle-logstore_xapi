define(["jquery","core/ajax","core/templates","core/str"],function(a,b,c,d){return{processResults:function(b,c){var d=[];return a.isArray(c)?(a.each(c,function(a,b){d.push({value:b.id,label:b._label})}),d):c},transport:function(e,f,g,h){var i,j=a(e).attr("userfields").split(","),k=parseInt(a(e).attr("perpage"));isNaN(k)&&(k=100),i=b.call([{methodname:"logstore_xapi_get_users",args:{search:f,page:0,perpage:k+1}}]),i[0].then(function(b){var e=[],f=0;return b.length<=k?(a.each(b,function(b,d){var f=d,g=[];a.each(j,function(a,b){"undefined"!=typeof d[b]&&""!==d[b]&&(f.hasidentity=!0,g.push(d[b]))}),f.identity=g.join(", "),e.push(c.render("logstore_xapi/form-user-selector-suggestion",f))}),a.when.apply(a.when,e).then(function(){var c=arguments;a.each(b,function(a,b){b._label=c[f],f++}),g(b)})):d.get_string("toomanyuserstoshow","core",">"+k).then(function(a){g(a)})}).fail(h)}}});